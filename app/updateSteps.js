

[{
    _id: {
        customId: '5af4841640130c1c07ee383e',
        date: '2017-03-02',
        title: 'Amazon Inc. Order',
        schoolId: '55e4ddddc588d547062bed7b',
        districtId: '55e4ddddc588d547062bed79',
        discount: 0,
        userName: 'Michelle Rowe',
        status: 'complete',
        userId: '57bc9102ba8113d1dddf16ac',
        type: 'internal',
        vendorOrderId: 133177,
        vendorId: '55fa1e4398eb4b0c07afaf29',
        purchaseOrderNumber: 'N/A',
        returnedTax: 0,
        shipping: -349,
        tax: 0,
        subTtotal: -1299
    },
    order: {
        title: 'Amazon Inc. Order',
        schoolId: '55e4ddddc588d547062bed7b',
        districtId: '55e4ddddc588d547062bed79',
        discount: 0,
        userName: 'Michelle Rowe',
        status: 'complete',
        userId: '57bc9102ba8113d1dddf16ac',
        originalDate: '2017-03-02',
        type: 'internal',
        shipping: -349,
        tax: 0,
        total: -1299,
        vendor: {
            vendorOrderId: 133177,
            vendorId: '55fa1e4398eb4b0c07afaf29',
            purchaseOrderNumber: 'N/A',
            items: [{
                itemdId: 'B01I90E1AC',
                quantity: 1,
                sumPrice: -1299,
                price: -1299,
                description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible HandleStand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue'
            }]
        },
        distributions: [{
            id: '57c46700f687533d06fbd75b',
            amount: 1648
        }],
        created: 2018 - 05 - 10 T17: 44: 57.533 Z,
        modified: 2018 - 05 - 10 T17: 44: 57.533 Z,
        completed: 2018 - 05 - 10 T17: 44: 57.533 Z,
        migratedReturns: true
    },
    original: [{
        _id: 5808098426 d6babb30004139,
        userId: '57bc9102ba8113d1dddf16ac',
        userName: 'Michelle Rowe',
        status: 'complete',
        created: 2016 - 10 - 20 T00: 02: 12.162 Z,
        modified: 2017 - 03 - 02 T16: 34: 51.286 Z,
        shipping: 519,
        tax: 0,
        total: 2217,
        vendor: {
            items: [{
                    itemId: 'B00004T8R2',
                    description: 'Panasonic On-Ear Stereo Headphones RP-HT21 (Black &amp; Silver) Lightweight and Comfortable, Powerful Bass',
                    quantity: 2,
                    price: 849
                },
                {
                    itemId: 'B01I07FLK8',
                    description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]',
                    quantity: 0,
                    price: 1295
                },
                {
                    itemId: 'B01I90E1AC',
                    description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible Handle Stand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue',
                    quantity: 0,
                    price: 1299
                }
            ],
            vendorName: 'Amazon Inc.',
            vendorId: '55fa1e4398eb4b0c07afaf29',
            purchaseOrderNumber: 'N/A',
            vendorOrderId: 133177,
            returningItems: [{
                    itemId: 'B01I07FLK8',
                    quantity: 1,
                    price: 1295,
                    description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]',
                    status: 'return_complete',
                    taxRefund: 0
                },
                {
                    itemId: 'B01I90E1AC',
                    quantity: 1,
                    price: 1299,
                    description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible Handle Stand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue',
                    status: 'return_complete',
                    taxRefund: 0
                }
            ],
            returningShipping: 349,
            cogs_discount: 0
        },
        schoolId: '55e4ddddc588d547062bed7b',
        districtId: '55e4ddddc588d547062bed79',
        title: 'Amazon Inc. Order',
        discount: 0,
        type: 'internal',
        exemptedTax: 0,
        purse: {
            purses: [{
                    id: '57c46700f687533d06fbd75b',
                    value: 4078
                },
                {
                    id: '57bc9a9b4896e0847687aa37',
                    value: 1082
                }
            ]
        },
        approval_distributions: [{
            amount: 4078,
            isProcessed: true,
            status: 'approved',
            id: '57c46700f687533d06fbd75b',
            createdBy: '57bc996aba8113d1dddf16f0',
            districtId: '55e4ddddc588d547062bed79',
            title: '$200 Supplemental Funds for Common Core 2016-2017',
            admin: 'Marti Ayala',
            adminId: '57bc9095ba8113d1dddf1662',
            date: 2016 - 10 - 20 T19: 26: 13.104 Z
        }],
        distributions: [{
                id: '57c46700f687533d06fbd75b',
                amount: -1135
            },
            {
                id: '57bc9a9b4896e0847687aa37',
                amount: -1082
            }
        ],
        completed: 2016 - 10 - 20 T19: 26: 13.587 Z,
        orderManagementStatus: 'items_return_complete',
        history: [{
                action: 'process_return_item',
                date: 2017 - 03 - 02 T16: 34: 19.046 Z,
                notes: 'item Id: B01I07FLK8, quantity: 1'
            },
            {
                action: 'process_return_item',
                date: 2017 - 03 - 02 T16: 34: 25.908 Z,
                notes: 'item Id: B01I90E1AC, quantity: 1'
            },
            {
                returningShipping: 349,
                action: 'shipping_refund',
                transactionStepId: 58 b849a04413ea3906d6bd15,
                date: 2017 - 03 - 02 T16: 34: 40.283 Z,
                distributions: [{
                    id: '57c46700f687533d06fbd75b',
                    amount: 349
                }]
            },
            {
                returningItems: [{
                    status: 'return_processing',
                    taxRefund: 0,
                    itemId: 'B01I07FLK8',
                    quantity: 1,
                    price: 1295,
                    description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]'
                }],
                action: 'complete_return_item',
                transactionStepId: 58 b849a44413ea3906d6bd1a,
                notes: 'item Id: B01I07FLK8, quantity: 1',
                date: 2017 - 03 - 04 T16: 34: 44.857 Z,
                distributions: [{
                    id: '57c46700f687533d06fbd75a',
                    amount: 1295
                }]
            },
            {
                returningItems: [{
                    status: 'return_processing',
                    taxRefund: 0,
                    itemId: 'B01I90E1AC',
                    quantity: 1,
                    price: 1299,
                    description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible Handle Stand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue'
                }],
                action: 'complete_return_item',
                transactionStepId: 58 b849ab4413ea3906d6bd1f,
                notes: 'item Id: B01I90E1AC, quantity: 1',
                date: 2017 - 03 - 02 T16: 34: 51.286 Z,
                distributions: [{
                    id: '57c46700f687533d06fbd75b',
                    amount: 1299
                }]
            }
        ],
        initialTotal: 5160,
        initialDistributions: [{
                id: '57c46700f687533d06fbd75b',
                amount: -4078
            },
            {
                id: '57bc9a9b4896e0847687aa37',
                amount: -1082
            }
        ]
    }]
},




{
    order: {
        title: 'Amazon Inc. Order',
        schoolId: '55e4ddddc588d547062bed7b',
        districtId: '55e4ddddc588d547062bed79',
        discount: 0,
        userName: 'Michelle Rowe',
        status: 'complete',
        userId: '57bc9102ba8113d1dddf16ac',
        originalDate: '2017-03-04',
        type: 'internal',
        shipping: 0,
        tax: 0,
        total: -1295,
        vendor: {
            vendorOrderId: 133177,
            vendorId: '55fa1e4398eb4b0c07afaf29',
            purchaseOrderNumber: 'N/A',
            items: [{
                itemdId: 'B01I07FLK8',
                quantity: 1,
                sumPrice: -1295,
                price: -1295,
                description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]'
            }]
        },
        distributions: [{
            id: '57c46700f687533d06fbd75a',
            amount: 1295
        }],
        created: 2018 - 05 - 10 T17: 44: 57.533 Z,
        modified: 2018 - 05 - 10 T17: 44: 57.533 Z,
        completed: 2018 - 05 - 10 T17: 44: 57.533 Z,
        migratedReturns: true
    },





    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    var itemHash = {}

    // Loop from ordersTemp
    order.vendor.items.forEach((v,i)=>{
        if(itemHash[v.itemdId]){
            itemHash[v.itemdId]["quantity"] += v.quantity;        
        }else{
            itemHash[v.itemdId] = {
                quantity: v.quantity
            }
        }
    }) 

    // Sample of the hash table 
    itemHash = {
        "B01I07FLK8" : {
            quantity: 1
        },
        "HGFB01I07FLK8" : {
            quantity: 1
        }
    }

    var incUpdate = {
        $inc: {
            shipping: neworderShippingValue (order.shipping),
            tax: newOrderTaxValue (order.tax)
        }
    }

    // this is going to find any items that need to be updated based on the items that are returned from the hash 
    original.vendor.items.forEach((oi, i)=>{
        if(itemHash[oi.itemId]){
            incUpdate["$inc"][`vendor.items.${i}.quantity`] = itemHash[oi.itemId].quantity;
        }
    });

    var incUpdate = {
        $inc: {
            "shipping" : 1234,
            "tax" : 454,
            "vendor.items.2.quantity" : 4,
            "vendor.items.5.quantity" : 4,
            "vendor.items.6.quantity" : 4
        }
    }

    { $set : { "distributions" :  initialDistributionsValue, total: initialTotalValue  }, incUpdate  }

    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~








    original: [{
        _id: 5808098426 d6babb30004139,
        userId: '57bc9102ba8113d1dddf16ac',
        userName: 'Michelle Rowe',
        status: 'complete',
        created: 2016 - 10 - 20 T00: 02: 12.162 Z,
        modified: 2017 - 03 - 02 T16: 34: 51.286 Z,
        shipping: 519,
        tax: 0,
        total: 2217,




        vendor: {
            items: [{
                    itemId: 'B00004T8R2',
                    description: 'Panasonic On-Ear Stereo Headphones RP-HT21 (Black &amp; Silver) Lightweight and Comfortable, Powerful Bass',
                    quantity: 2,
                    price: 849
                },
                {
                    itemId: 'B01I07FLK8',
                    description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]',
                    quantity: 0,
                    price: 1295
                },
                {
                    itemId: 'B01I90E1AC',
                    description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible Handle Stand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue',
                    quantity: 0,
                    price: 1299
                }
            ],



            vendorName: 'Amazon Inc.',
            vendorId: '55fa1e4398eb4b0c07afaf29',
            purchaseOrderNumber: 'N/A',
            vendorOrderId: 133177,
            returningItems: [{
                    itemId: 'B01I07FLK8',
                    quantity: 1,
                    price: 1295,
                    description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]',
                    status: 'return_complete',
                    taxRefund: 0
                },
                {
                    itemId: 'B01I90E1AC',
                    quantity: 1,
                    price: 1299,
                    description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible Handle Stand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue',
                    status: 'return_complete',
                    taxRefund: 0
                }
            ],
            returningShipping: 349,
            cogs_discount: 0
        },
        schoolId: '55e4ddddc588d547062bed7b',
        districtId: '55e4ddddc588d547062bed79',
        title: 'Amazon Inc. Order',
        discount: 0,
        type: 'internal',
        exemptedTax: 0,
        purse: {
            purses: [{
                    id: '57c46700f687533d06fbd75b',
                    value: 4078
                },
                {
                    id: '57bc9a9b4896e0847687aa37',
                    value: 1082
                }
            ]
        },
        approval_distributions: [{
            amount: 4078,
            isProcessed: true,
            status: 'approved',
            id: '57c46700f687533d06fbd75b',
            createdBy: '57bc996aba8113d1dddf16f0',
            districtId: '55e4ddddc588d547062bed79',
            title: '$200 Supplemental Funds for Common Core 2016-2017',
            admin: 'Marti Ayala',
            adminId: '57bc9095ba8113d1dddf1662',
            date: 2016 - 10 - 20 T19: 26: 13.104 Z
        }],
        distributions: [{
                id: '57c46700f687533d06fbd75b',
                amount: -1135
            },
            {
                id: '57bc9a9b4896e0847687aa37',
                amount: -1082
            }
        ],
        completed: 2016 - 10 - 20 T19: 26: 13.587 Z,
        orderManagementStatus: 'items_return_complete',
        history: [{
                action: 'process_return_item',
                date: 2017 - 03 - 02 T16: 34: 19.046 Z,
                notes: 'item Id: B01I07FLK8, quantity: 1'
            },
            {
                action: 'process_return_item',
                date: 2017 - 03 - 02 T16: 34: 25.908 Z,
                notes: 'item Id: B01I90E1AC, quantity: 1'
            },
            {
                returningShipping: 349,
                action: 'shipping_refund',
                transactionStepId: 58 b849a04413ea3906d6bd15,
                date: 2017 - 03 - 02 T16: 34: 40.283 Z,
                distributions: [{
                    id: '57c46700f687533d06fbd75b',
                    amount: 349
                }]
            },
            {
                returningItems: [{
                    status: 'return_processing',
                    taxRefund: 0,
                    itemId: 'B01I07FLK8',
                    quantity: 1,
                    price: 1295,
                    description: 'iPad 2 3 4 Screen Protector,TANTEK [HD-Clear][Anti-Scratch][Anti-Glare][Anti-Fingerprint] Tempered Glass Screen Protector for Apple iPad 2 / iPad 3 / iPad 4 (9.7 inch),[Lifetime Warranty]-[2Pack]'
                }],
                action: 'complete_return_item',
                transactionStepId: 58 b849a44413ea3906d6bd1a,
                notes: 'item Id: B01I07FLK8, quantity: 1',
                date: 2017 - 03 - 04 T16: 34: 44.857 Z,
                distributions: [{
                    id: '57c46700f687533d06fbd75a',
                    amount: 1295
                }]
            },
            {
                returningItems: [{
                    status: 'return_processing',
                    taxRefund: 0,
                    itemId: 'B01I90E1AC',
                    quantity: 1,
                    price: 1299,
                    description: 'AVAWO Apple iPad 2 3 4 Kids Case - Light Weight Shock Proof Convertible Handle Stand Kids Friendly for iPad 2, iPad 3rd generation, iPad 4th generation Tablet - Blue'
                }],
                action: 'complete_return_item',
                transactionStepId: 58 b849ab4413ea3906d6bd1f,
                notes: 'item Id: B01I90E1AC, quantity: 1',
                date: 2017 - 03 - 02 T16: 34: 51.286 Z,
                distributions: [{
                    id: '57c46700f687533d06fbd75b',
                    amount: 1299
                }]
            }
        ],


        initialTotal: 5160, // $set initialTotal value to total 
        initialDistributions: [{  // $set initialDistributions valu to distribution
                id: '57c46700f687533d06fbd75b',
                amount: -4078
            },
            {
                id: '57bc9a9b4896e0847687aa37',
                amount: -1082
            }
        ]



    }]
}
]
